<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM33 Visibility Test - Blue-on-Blue Detection</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
        }

        [data-theme="dark"] .test-section {
            background: rgba(30, 41, 59, 0.9);
        }

        .visibility-issue {
            padding: 16px;
            border-radius: 8px;
            margin: 8px 0;
            border: 2px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .visibility-pass {
            padding: 16px;
            border-radius: 8px;
            margin: 8px 0;
            border: 2px solid #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            margin: 8px;
            font-weight: 600;
        }

        /* Test cases - problematic styles */
        .blue-on-blue-bad {
            background: #667eea;
            color: #764ba2;
            padding: 8px;
            border-radius: 4px;
            margin: 4px;
        }

        .indigo-on-indigo-bad {
            background: #764ba2;
            color: #667eea;
            padding: 8px;
            border-radius: 4px;
            margin: 4px;
        }

        /* Fixed styles using PM33 classes */
        .pm33-text-primary {
            color: var(--text-primary, #1e293b);
        }

        .pm33-text-brand {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .pm33-text-contrast-safe {
            color: var(--text-primary, #1e293b);
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
        }

        .pm33-text-accent {
            color: #4a9b9e;
        }

        /* Theme variables */
        :root {
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        [data-theme="dark"] {
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }
    </style>
</head>
<body data-theme="light">
    <div class="theme-toggle">
        <button class="test-button" onclick="toggleTheme()">
            üåô Toggle Theme
        </button>
    </div>

    <div class="test-container">
        <h1>PM33 Visibility Test - Blue-on-Blue Detection</h1>
        
        <div class="test-section">
            <h2>‚ùå Problematic Examples (Before Fix)</h2>
            <div class="visibility-issue">
                <h4>Blue on Blue - Nearly Invisible</h4>
                <div class="blue-on-blue-bad">This text is blue (#764ba2) on blue background (#667eea) - INVISIBLE!</div>
                <div class="indigo-on-indigo-bad">This text is indigo (#667eea) on indigo background (#764ba2) - INVISIBLE!</div>
                <p><strong>Contrast Ratio:</strong> ~1.2:1 (FAILS WCAG - needs 4.5:1 minimum)</p>
            </div>
        </div>

        <div class="test-section">
            <h2>‚úÖ Fixed Examples (After PM33 Classes)</h2>
            <div class="visibility-pass">
                <h4>PM33 Theme-Aware Text Classes</h4>
                <p class="pm33-text-primary">Primary text: Always visible with theme-aware contrast</p>
                <p class="pm33-text-brand">Brand gradient text: Visible gradient effect instead of flat color</p>
                <p class="pm33-text-contrast-safe">Contrast-safe text: Extra shadow ensures visibility</p>
                <p class="pm33-text-accent">Accent text: Teal color with good contrast ratio</p>
                <p><strong>Contrast Ratios:</strong> All >4.5:1 (PASSES WCAG AA)</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üîç Automated Visibility Detection</h2>
            <div id="detection-results">
                <button class="test-button" onclick="runVisibilityTest()">
                    üöÄ Run Visibility Detection
                </button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Test Results Summary</h2>
            <div id="results-summary">
                <p>Click "Run Visibility Detection" to analyze all elements on this page.</p>
            </div>
        </div>
    </div>

    <script>
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            body.setAttribute('data-theme', newTheme);
            
            const toggleButton = document.querySelector('.theme-toggle button');
            toggleButton.textContent = newTheme === 'light' ? 'üåô Toggle Theme' : '‚òÄÔ∏è Toggle Theme';
            
            console.log('Theme switched to:', newTheme);
        }

        function getBrightness(color) {
            // Extract RGB values
            const rgb = color.match(/\d+/g);
            if (!rgb || rgb.length < 3) return 128; // Default fallback
            
            // Calculate brightness using standard formula
            return (parseInt(rgb[0]) * 0.299 + parseInt(rgb[1]) * 0.587 + parseInt(rgb[2]) * 0.114);
        }

        function calculateContrastRatio(color1, color2) {
            const brightness1 = getBrightness(color1);
            const brightness2 = getBrightness(color2);
            
            const lighter = Math.max(brightness1, brightness2);
            const darker = Math.min(brightness1, brightness2);
            
            return (lighter + 0.05) / (darker + 0.05);
        }

        function runVisibilityTest() {
            const results = [];
            const allElements = document.querySelectorAll('*');
            let totalElements = 0;
            let problematicElements = 0;
            let goodElements = 0;

            allElements.forEach((element, index) => {
                if (element.offsetWidth === 0 || element.offsetHeight === 0) return;
                
                const styles = window.getComputedStyle(element);
                const color = styles.color;
                const backgroundColor = styles.backgroundColor;
                
                // Skip transparent backgrounds
                if (backgroundColor === 'rgba(0, 0, 0, 0)' || backgroundColor === 'transparent') return;
                
                totalElements++;
                const contrastRatio = calculateContrastRatio(color, backgroundColor);
                
                if (contrastRatio < 3.0) {
                    problematicElements++;
                    results.push({
                        element: element.tagName.toLowerCase() + (element.className ? '.' + element.className.split(' ')[0] : ''),
                        textColor: color,
                        backgroundColor: backgroundColor,
                        contrastRatio: contrastRatio.toFixed(2),
                        status: 'FAIL'
                    });
                } else {
                    goodElements++;
                    results.push({
                        element: element.tagName.toLowerCase() + (element.className ? '.' + element.className.split(' ')[0] : ''),
                        textColor: color,
                        backgroundColor: backgroundColor,
                        contrastRatio: contrastRatio.toFixed(2),
                        status: 'PASS'
                    });
                }
            });

            // Display results
            const resultsDiv = document.getElementById('detection-results');
            const summaryDiv = document.getElementById('results-summary');
            
            resultsDiv.innerHTML = `
                <h4>Detailed Detection Results:</h4>
                <div style="max-height: 300px; overflow-y: auto; padding: 16px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                    ${results.slice(0, 10).map(r => `
                        <div style="margin: 8px 0; padding: 8px; border-radius: 4px; background: ${r.status === 'FAIL' ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)'};">
                            <strong>${r.element}</strong> - Contrast: ${r.contrastRatio}:1 
                            <span style="color: ${r.status === 'FAIL' ? '#ef4444' : '#10b981'};">${r.status}</span>
                        </div>
                    `).join('')}
                    ${results.length > 10 ? `<p><em>... and ${results.length - 10} more elements</em></p>` : ''}
                </div>
            `;

            summaryDiv.innerHTML = `
                <h4>üìä Summary Results:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <div style="padding: 16px; border-radius: 8px; background: rgba(16, 185, 129, 0.1);">
                        <h3 style="margin: 0; color: #10b981;">${goodElements}</h3>
                        <p style="margin: 4px 0;">Elements with Good Contrast</p>
                    </div>
                    <div style="padding: 16px; border-radius: 8px; background: rgba(239, 68, 68, 0.1);">
                        <h3 style="margin: 0; color: #ef4444;">${problematicElements}</h3>
                        <p style="margin: 4px 0;">Elements with Poor Contrast</p>
                    </div>
                    <div style="padding: 16px; border-radius: 8px; background: rgba(59, 130, 246, 0.1);">
                        <h3 style="margin: 0; color: #3b82f6;">${totalElements}</h3>
                        <p style="margin: 4px 0;">Total Elements Analyzed</p>
                    </div>
                    <div style="padding: 16px; border-radius: 8px; background: rgba(168, 85, 247, 0.1);">
                        <h3 style="margin: 0; color: #a855f7;">${((goodElements / totalElements) * 100).toFixed(1)}%</h3>
                        <p style="margin: 4px 0;">Accessibility Score</p>
                    </div>
                </div>
                <p><strong>WCAG Guidelines:</strong> Contrast ratio should be at least 4.5:1 for normal text, 3.0:1 for large text.</p>
            `;

            console.log('Visibility test complete:', {
                total: totalElements,
                problematic: problematicElements,
                good: goodElements,
                score: ((goodElements / totalElements) * 100).toFixed(1) + '%'
            });
        }

        // Auto-run test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('PM33 Visibility Test Page Loaded');
            // Uncomment to auto-run the test
            // setTimeout(runVisibilityTest, 1000);
        });
    </script>
</body>
</html>